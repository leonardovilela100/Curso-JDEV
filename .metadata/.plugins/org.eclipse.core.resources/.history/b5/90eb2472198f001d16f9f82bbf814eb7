package enviando.email;

import java.util.Properties;

import javax.mail.Authenticator;
import javax.mail.Message;
import javax.mail.MessagingException;
import javax.mail.PasswordAuthentication;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;

public class ImapEmailSender {

    private static final String SMTP_SERVER = "imap.outlook.com";
    private static final String USERNAME = "your_email@outlook.com";
    private static final String PASSWORD = "your_password";

    private static final String EMAIL_FROM = "your_email@outlook.com";
    private static final String EMAIL_TO = "recipient_email@example.com";
    private static final String EMAIL_SUBJECT = "Test Email via IMAP";
    private static final String EMAIL_TEXT = "This is a test email sent through the Java Mail API using the IMAP protocol.";

    public static void main(String[] args) {

        Properties prop = new Properties();
        prop.put("mail.imap.ssl.enable", "true"); // Enable SSL
        prop.put("mail.imap.auth.mechanisms", "XOAUTH2"); // Enable OAuth2
        prop.put("mail.imap.host", SMTP_SERVER); // Set the SMTP server
        prop.put("mail.imap.port", "993"); // Set the port for the SMTP server

        // Create a Session object to represent a mail session with the specified properties.
        Session session = Session.getDefaultInstance(prop, new Authenticator() {
            protected PasswordAuthentication getPasswordAuthentication() {
                return new PasswordAuthentication(USERNAME, PASSWORD);
            }
        });

        try {
            // Create a message object
            MimeMessage message = new MimeMessage(session);

            // Set the sender's address
            message.setFrom(new InternetAddress(EMAIL_FROM));

            // Set the recipient's address
            message.setRecipient(Message.RecipientType.TO, new InternetAddress(EMAIL_TO));

            // Set the email's subject
            message.setSubject(EMAIL_SUBJECT);

            // Set the email's text
            message.setText(EMAIL_TEXT);

            // Send the email
            Transport.send(message);

            System.out.println("Email sent successfully!");

        } catch (MessagingException e) {
            e.printStackTrace();
        }
    }
}
